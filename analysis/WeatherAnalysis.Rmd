---
title: "Weather Analysis"
output: html_notebook
---

Understanding the correlation between weather on JSE.


# Import the data 
The historical weather data for varies parts of SA have been downloaded, accompanied with the movement of the JSE all shares index over the same period.
```{r}
# set working directory 
setwd("~/Desktop/Quanta_CS/analysis")

# import weather data
jhb = read.csv("../data/weather/johannesburg.csv")
ct = read.csv("../data/weather/capetown.csv")
dur = read.csv("../data/weather/durban.csv")
pta = read.csv("../data/weather/pretoria.csv")
blm = read.csv("../data/weather/Bloemfontein.csv")

# JSE data
jse = read.csv('../data/jse/JALSH.csv')
```

### Clean Stock Data
```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)

# clean data
jse$Price = as.numeric(gsub(",", "",jse$Price))
jse$Open = as.numeric(gsub(",", "",jse$Open))
jse$Low = as.numeric(gsub(",", "",jse$Low))
jse$High = as.numeric(gsub(",", "",jse$High))

# Volume 
jse$Vol. = gsub("M", "000000", jse$Vol.)
jse$Vol. = gsub("B", "000000000", jse$Vol.)
jse$Vol. = as.numeric(jse$Vol.)
jse$Vol.[which(jse$Vol. < 10)] = jse$Vol.[jse$Vol. < 10]*10000

# Date
jse$Date = as.Date(jse$Date, format="%b %d, %Y")

# Keep: date, price & vol
jse = jse %>% select('Date', "Price", "Vol.")


```


# Examine Results
```{r}

# View Cleanup
head(jse)

# standardized price
jse$z_price = (jse$Price - mean(jse$Price))/sd(jse$Price)


# plot 
jse_plot <- ggplot(jse, aes(x=Date, y=Price)) + geom_line(col='darkblue') + ggtitle("JSE All Shares Index")
jse_plot_z <- ggplot(jse, aes(x=Date, y=z_price)) + geom_line(col='maroon') + ggtitle("JSE All Shares Index Standardized")

jse_plot
jse_plot_z


```


### Clean Weather Data 
```{r}
library(dplyr)

# date
jhb$Date = as.Date(jhb$date_time)
ct$Date = as.Date(ct$date_time)
dur$Date = as.Date(dur$date_time)
pta$Date = as.Date(pta$date_time)
blm$Date = as.Date(blm$date_time)




install.packages("docstring")
library(docstring)


dataset = jhb
    # average per day & stdard value
    daily_mean <- dataset %>% group_by(Date) %>% summarise(mean = mean(dataset$tempC)) 
    mean_z <- (daily_mean$mean - mean(daily_mean$mean))/sd(daily_mean$mean)
    
    daily_mean
    mean_z
    # add to dataset
    dataset$paste(i, "_z", sep="") <- mean_z



standard_mean_temp <- function(dataset, vars, list=FALSE) {
  " Return standardized variable - attached to dataframe " 
    print(dataset)
  
    # average per day & stdard value
    daily_mean <- dataset %>% group_by(Date) %>% summarise(mean = mean(vars)) 
    mean_z <- (daily_mean$mean - mean(daily_mean$mean))/sd(daily_mean$mean)
    
    print(daily_mean)
    print(mean_z)
    # add to dataset
    dataset$paste(i, "_z", sep="") <- mean_z
}


standard_mean_temp(jhb, jhb$tempC)

length(c(jhb$tempC))


  # select desired columns
  t = t %>% select('Date', 'temp_z', 'z_price','Vol.') 
  
  
  print(paste("Correlation", cor(t$z_price, t$temp_z))) 





# visualize
ggplot(t, aes(x=Date, y=z_price)) + geom_line(col='darkgreen') +
  geom_line(aes(x=Date, y=temp_z), col='darkred') + ggtitle("Temp vs JSE")



```





  # average temperature per day
  jhb_mean_temp <- jhb %>% group_by(date_time) %>% summarise(mean_temp = mean(tempC))
  
  # merge datasets
  jhb_mean_temp$Date = jhb_mean_temp$date_time
  t = merge(jhb_mean_temp, jse, by='Date')
  t$temp_z = (t$mean_temp - mean(t$mean_temp))/sd(t$mean_temp)
  
  
  # select desired columns
  t = t %>% select('Date', 'temp_z', 'z_price','Vol.') 
  
  
  print(paste("Correlation", cor(t$z_price, t$temp_z))) 










